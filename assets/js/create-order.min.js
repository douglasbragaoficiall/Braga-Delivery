const order={orderType:{type:"",typeName:""},customer:{name:"",phone:"",cpf:""},address:{street:"",number:"",comp:"",neighborhood:"",zipcode:""},shipping:{type:"",price:"",table:""},products:[],orderTotal:{total:"",finalPrice:"",paymentMethod:"",change:"",coupon:"",couponDesc:""}};function showSpinner(){document.querySelector(".myd-cart").classList.add("loading")}function hideSpinner(){document.querySelector(".myd-cart").classList.remove("loading")}function createOrder(e){""!=sessionStorage.getItem("mydOrder")&&null!=sessionStorage.getItem("mydOrder")||sessionStorage.setItem("mydOrder",JSON.stringify(e))}function saveOrder(e){sessionStorage.setItem("mydOrder",JSON.stringify(e))}function addToOrder(){if(!1===checkRequiredExtra(this))return;if(!1===checkMinLimit(this))return;if(!1===checkStoreTime())return;if(0==checkProductStock(this))return;let e=getProduct.call(this),t=getOrder();t.products=t.products.concat(e),t.orderTotal.total=calculateOrderTotal(t),saveOrder(t),addTemplateToCart(t),updateCountTotal(t),document.getElementById("popup-"+this.id).classList.toggle("myd-hide-element"),document.querySelectorAll('input[type="checkbox"]').forEach((e=>e.checked=!1)),notificationBar("success",mydStoreInfo.messages.addToCard);let r=new CustomEvent("MydAddedToCart",{detail:{product:e},bubbles:!0,cancelable:!0,composed:!1});window.dispatchEvent(r),document.querySelectorAll(".fmd-item-qty").forEach((e=>{e.value="1"}))}function checkRequiredExtra(e){let t=document.getElementById("popup-"+e.id),r=[];if(t.querySelectorAll(".fdm-extra-option-title").forEach((e=>{"required"==e.dataset.obj&&0==e.querySelectorAll("input[type=checkbox]:checked").length&&r.push("stop")})),r.includes("stop"))return notificationBar("error",mydStoreInfo.messages.extraRequired),!1}function checkProductStock(e){let t=parseInt(document.getElementById("fmd-item-stock-"+e.id).value);if(parseInt(document.getElementById("fmd-item-qty-"+e.id).value)>t)return notificationBar("error","Limite de estoque alcançado! ("+t+" unidades)"),!1}function checkMinLimit(e){const t=[],r=document.getElementById("popup-"+e.id);if(!r)return;const o=r.querySelectorAll(".fdm-extra-option-title");return o.length<1?void 0:(o.forEach((e=>{e.dataset.min&&e.dataset.min>0&&e.querySelectorAll(".option_prod_exta:checked").length<e.dataset.min&&t.length<=0&&(t.push("true"),notificationBar("error",mydStoreInfo.messages.extraMin))})),t.length<=0)}function calculateOrderTotal(e){return e.products.map((e=>e.productPriceTotal)).reduce(sumPrices,0)}function getProduct(){let e=[],t=this.id,r=this.dataset.name,o=this.dataset.price,n=document.querySelector("#popup-"+t+" .fmd-item-qty").value,a=document.querySelector("#myd-product-note-"+t).value,c=this.dataset.image,d=document.querySelectorAll("#popup-"+t+" .option_prod_exta:checked"),l=document.getElementById("fmd-item-stock-"+t).value;return i={productId:t,productName:r,productPrice:o,productImage:c,productPriceTotal:"",productQty:n,productNote:a,productStock:l,extras:""},i.extras=getProductExtra(d),i.productPriceTotal=calculateProductPrice(i),e.push(i),e}function getProductExtra(e){if(e.length>0){let t=[];return e.forEach((e=>{let r={extraType:e.dataset.type,extraOptions:[]};t.map((e=>e.extraType)).includes(e.dataset.type)||t.push(r)})),getProductExtraOptions(e,t),t}}function getProductExtraOptions(e,t){return e.forEach((e=>{let r=t.map((e=>e.extraType)).indexOf(e.dataset.type),o={extraOptionName:e.dataset.name,extraOptionPrice:e.dataset.price};t[r].extraOptions.push(o)})),t}function calculateProductPrice(e){if(null!=e.extras){let t=e.extras.map((e=>e.extraOptions.map((e=>e.extraOptionPrice))));return t=(t=t.flat()).reduce(sumPrices,0),t+=parseInt(e.productPrice.replace(/[.,]/g,"")),""+(t*=parseInt(e.productQty.replace(/[.,]/g,"")))}return singlePrice=parseInt(e.productPrice.replace(/[.,]/g,""))*parseInt(e.productQty.replace(/[.,]/g,"")),`${singlePrice}`}function formatPrice(e){if(numberDecimal=mydStoreInfo.currency.decimalNumbers,decimalSeparator=mydStoreInfo.currency.decimalSeparator,0==e)return 0;number=`${e}`;let t=number.slice(-+numberDecimal),r=number.slice(0,-+numberDecimal),o=parseInt(numberDecimal)+3,n=number.slice(0,-+o);return""!=n?n+"."+number.slice(-+o,-+numberDecimal)+decimalSeparator+t:r+decimalSeparator+t}function formatCurrency(e){return(e||0).toLocaleString(void 0,{minimumFractionDigits:2})}function sumPrices(e,t){return parseInt(e)+parseInt(t.replace(/[.,]/g,""))}function addTemplateToCart(e){let t=document.getElementById("myd-template-product-item").innerText,r=document.querySelector(".myd-cart__products");document.querySelectorAll(".myd-cart__products-item").forEach((e=>e.remove())),e.products.forEach(((e,o)=>{let n=t.replace(/`{qty}`/g,e.productQty);n=(n=(n=(n=n.replace(/`{name}`/g,e.productName)).replace(/`{image}`/g,e.productImage)).replace(/`{currency}`/g,mydStoreInfo.currency.symbol)).replace(/`{price}`/g,formatPrice(e.productPriceTotal)),n=(n=null!=e.extras?n.replace(/`{extras}`/g,addTemplateExtras(e.extras).join("")):n.replace(/`{extras}`/g,"")).replace(/`{index}`/g,o),r.insertAdjacentHTML("beforeend",n),delete n}))}function addTemplateExtras(e){let t=document.getElementById("myd-template-product-item-extra").innerText,r=document.getElementById("myd-template-product-item-extra-name").innerText,o=[],n=[];return e.forEach((e=>{let a=t.replace(/`{extraType}`/g,e.extraType);n=(n=e.extraOptions.map((e=>r.replace(/`{extraItemName}`/g,e.extraOptionName)))).flat(),a=a.replace(/`{extraName}`/g,n.join("")),o.push(a),delete a})),o}function removeItem(e){let t=getOrder();t.products.splice(e,1),t.orderTotal.total=calculateOrderTotal(t),saveOrder(t),addTemplateToCart(t),updateCountTotal(t),notificationBar("error",mydStoreInfo.messages.removedFromCart)}function notificationBar(e,t){0==mydStoreInfo.messages.template&&(template=document.getElementById("myd-popup-notification"),mydStoreInfo.messages.template=template),mydStoreInfo.messages.template.querySelector(".myd-popup-notification__message").innerHTML=t,"success"==e&&(mydStoreInfo.messages.template.style.background="#35a575"),"error"==e&&(mydStoreInfo.messages.template.style.background="#cb2027"),mydStoreInfo.messages.template.style.opacity="1",mydStoreInfo.messages.template.style.visibility="visible",setTimeout((function(){mydStoreInfo.messages.template.style.opacity="0",mydStoreInfo.messages.template.style.visibility="hidden"}),3e3)}function updateCountTotal(e){""==e.orderTotal.total||0==e.orderTotal.total?(document.getElementById("myd-float__price").innerText=mydStoreInfo.currency.symbol,document.getElementById("myd-float__qty").innerText="0"):(document.getElementById("myd-float__price").innerText=mydStoreInfo.currency.symbol+" "+formatPrice(e.orderTotal.total),document.getElementById("myd-float__qty").innerText=e.products.length)}function validateInputs(e){let t="";t="checkout"===e?document.querySelectorAll(".myd-cart__checkout input, .myd-cart__checkout select"):document.querySelectorAll(".myd-cart__payment input, .myd-cart__payment select");for(let e=0;e<t.length;e++)if(t[e].hasAttribute("required")&&""==t[e].value)return notificationBar("error",mydStoreInfo.messages.inputRequired),t[e].focus(),!1;delete t}function checkMinimumPurchase(){let e=getOrder(),t="",r=mydStoreInfo.minimumPurchase;if(t=e.orderTotal.total,r=r.replace(/[.,]/g,""),parseInt(t)<parseInt(r))return notificationBar("error",mydStoreInfo.messages.minimumPrice+" "+mydStoreInfo.currency.symbol+" "+mydStoreInfo.minimumPurchase),!1}function checkStoreTime(){if("forceStore"in mydStoreInfo){if("open"===mydStoreInfo.forceStore)return!0;if("close"===mydStoreInfo.forceStore)return notificationBar("error",mydStoreInfo.messages.storeClosed),!1}let e=JSON.parse(mydStoreInfo.deliveryTime),t=[],r=Date.parse("01/01/2011 "+(new Date).toLocaleTimeString("en-US"));return Object.keys(e).forEach((o=>{start=Date.parse("01/01/2011 "+e[o].start+":00"),end=Date.parse("01/01/2011 "+e[o].end+":00"),r>=start&&r<=end&&t.push(!0)})),!!t.includes(!0)||(notificationBar("error",mydStoreInfo.messages.storeClosed),!1)}function updateOrderChekout(e){let t=getOrder();t.customer.name=e.name,t.customer.phone=e.phone,t.orderTotal.paymentMethod=e.payment,t.orderTotal.change=e.change,t.orderTotal.coupon=e.coupon,t.orderType.type=e.orderType,t.orderType.typeName=e.orderTypeName,t.address.street=e.address,t.address.number=e.number,t.address.comp=e.apartment,t.address.neighborhood=e.neig,t.address.zipcode=e.zipcode,t.shipping.table=e.table,t.shipping.price=e.shippingPrice,t.orderTotal.finalPrice=parseInt(t.orderTotal.total)+parseInt(t.shipping.price),saveOrder(t)}function updateCartLayoutItems(){let e=getOrder();const t=document.getElementById("myd-cart-payment-subtotal-value");t&&(t.innerText=mydStoreInfo.currency.symbol+" "+formatPrice(e.orderTotal.total));const r=document.getElementById("myd-cart-payment-total-value");if(r&&(r.innerText=mydStoreInfo.currency.symbol+" "+formatPrice(e.orderTotal.finalPrice)),"delivery"===e.orderType.type){const t=document.getElementById("myd-cart-payment-delivery-fee-value"),r=document.getElementById("myd-card-payment-row-delivery-fee");t&&r&&(r.classList.remove("myd-hidden"),t.innerText=mydStoreInfo.currency.symbol+" "+formatPrice(e.shipping.price))}if(""!==e.orderTotal.coupon){const t=document.getElementById("myd-cart-payment-coupon-value"),r=document.getElementById("myd-card-payment-row-coupon");t&&r&&(r.classList.remove("myd-hidden"),t.innerText=e.orderTotal.couponDesc)}}function validateZipcodeShipping(e){if("delivery"!=e)return;let t=mydStoreInfo.deliveryShipping.method;if("per-cep-range"==t||"fixed-per-cep"==t){let e=JSON.parse(mydStoreInfo.deliveryShipping.options),t=parseInt(document.getElementById("input-delivery-zipcode").value),r=[];if(Object.keys(e.options).forEach((o=>{t>=e.options[o].from&&t<=e.options[o].to&&r.push(!0)})),0===r.length)return notificationBar("error",mydStoreInfo.messages.deliveryAreaError),!1}}function calculateCoupon(){let e=document.getElementById("input-coupon");if(!e)return;e=e.value;const t=getOrder();if(""===e)return t.orderTotal.couponDesc="",t.orderTotal.coupon="",void saveOrder(t);let r=document.getElementById("myd-cart__coupons-obj").innerText,o=JSON.parse(r),n="",a=t.orderType.type,i="";if(o.map(((t,r)=>{t.name==e&&(i=r)})),0==i.length)return notificationBar("error",mydStoreInfo.messages.invalidCoupon),t.orderTotal.couponDesc="",t.orderTotal.coupon="",void saveOrder(t);if(null!=i){if("discount-total"==o[i].type){if("amount"==o[i].format)return n=parseInt(t.orderTotal.finalPrice)-parseInt(o[i].value.replace(/[.,]/g,"")),t.orderTotal.finalPrice=n,t.orderTotal.couponDesc="-"+formatPrice(o[i].value.replace(/[.,]/g,""))+" total",void saveOrder(t);if("percent"==o[i].format)return n=parseInt(t.orderTotal.finalPrice)-parseInt(t.orderTotal.finalPrice)*parseInt(o[i].value)/100,t.orderTotal.finalPrice=n.toFixed(),t.orderTotal.couponDesc="-"+parseInt(o[i].value)+"% delivery",void saveOrder(t)}if("discount-delivery"==o[i].type&&"delivery"==a){if("amount"==o[i].format)return n=parseInt(t.shipping.price)-parseInt(o[i].value.replace(/[.,]/g,"")),t.shipping.price=n,t.orderTotal.finalPrice=parseInt(t.orderTotal.total)+parseInt(t.shipping.price),t.orderTotal.couponDesc="-"+formatPrice(o[i].value.replace(/[.,]/g,""))+" total",void saveOrder(t);if("percent"==o[i].format)return n=parseInt(t.shipping.price)-parseInt(t.shipping.price)*parseInt(o[i].value)/100,t.shipping.price=n,t.orderTotal.finalPrice=parseInt(t.orderTotal.total)+parseInt(t.shipping.price),t.orderTotal.couponDesc="-"+parseInt(o[i].value)+"% delivery",void saveOrder(t)}}}async function calculateShipping(){let e=mydStoreInfo.deliveryShipping.method;if("fixed-per-neighborhood"==e)return JSON.parse(mydStoreInfo.deliveryShipping.options).price.replace(/[.,]/g,"");if("per-neighborhood"==e){let e=JSON.parse(mydStoreInfo.deliveryShipping.options),t=document.getElementById("input-delivery-neighborhood").value,r=[];return Object.keys(e.options).forEach((o=>{e.options[o].from===t&&r.push(e.options[o].price)})),r[0].replace(/[.,]/g,"")}if("per-cep-range"==e){let e=JSON.parse(mydStoreInfo.deliveryShipping.options),t=parseInt(document.getElementById("input-delivery-zipcode").value),r=[];return Object.keys(e.options).forEach((o=>{t>=e.options[o].from&&t<=e.options[o].to&&r.push(e.options[o].price)})),r[0].replace(/[.,]/g,"")}if("per-distance"==e){let e=parseInt(document.getElementById("input-delivery-zipcode").value);return(await googleAPI(e).catch(hideSpinner)).toFixed(2).toLocaleString(void 0,{minimumFractionDigits:2}).replace(/[,|\.]/g,"")}return"fixed-per-cep"==e?JSON.parse(mydStoreInfo.deliveryShipping.options).price.replace(/[.,]/g,""):void 0}function googleAPI(e){return new Promise(((t,r)=>{var o=document.location.origin;fetch(`${o}/wp-json/drope-delivery/v1/google-api?destination=${e}`).then((async e=>{const o=await e.json();"OK"===o?.status?t(o?.delivery_fee):(notificationBar("error","Insira um CEP válido."),r("error"))})).catch((function(e){console.log("Fetch Error :-S",e),r(e)}))}))}async function processCheckout(e,t){showSpinner();let r={name:document.getElementById("input-customer-name").value,phone:document.getElementById("input-customer-phone").value,payment:document.getElementById("input-payment").value,change:document.getElementById("input-payment-change").value,coupon:document.getElementById("input-coupon").value,orderType:e,orderTypeName:t,address:"",number:"",apartment:"",neig:"",zipcode:"",table:"",shippingPrice:0};if("delivery"==e){r.address=document.getElementById("input-delivery-street-name").value;let e=document.getElementById("input-delivery-address-number");null!=e&&(r.number=e.value),r.apartment=document.getElementById("input-delivery-comp").value;let t=document.getElementById("input-delivery-neighborhood");null!=t&&(r.neig=t.value);let o=document.getElementById("input-delivery-zipcode");null!=o&&(r.zipcode=o.value),r.table="",r.shippingPrice=await calculateShipping(),updateOrderChekout(r)}"take-away"==e&&(r.address="",r.number="",r.apartment="",r.neig="",r.zipcode="",r.table="",updateOrderChekout(r)),"order-in-store"==e&&(r.address="",r.number="",r.apartment="",r.neig="",r.zipcode="",r.table=document.getElementById("input-in-store-table").value,updateOrderChekout(r)),calculateCoupon(),hideSpinner()}function finishOrder(e){let t=document.getElementById("myd-template-order-loading").innerText;document.querySelector(".myd-cart__button-text").innerHTML=t;let r=JSON.stringify(getOrder());fetch(ajax_object.ajax_url,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded","Cache-Control":"no-cache"},body:"action=myd_create_order&data="+r+"&sec="+ajax_object.order_nonce}).then((t=>{t.ok?t.json().then((t=>{const r=document.getElementById("finished-order-number"),o=document.querySelector(".myd-cart__finished-whatsapp > a"),n=document.querySelector(".myd-cart__finished-track-order > a");r.innerText=t.order_id,o.href=t.link,n.href=t.trackLink,clearOrder(),e.classList.remove("myd-cart__nav--active"),document.querySelector("."+e.dataset.tabContent).classList.remove("myd-cart__content--active"),document.querySelector("."+e.dataset.next).classList.add("myd-cart__content--active"),document.querySelector(".myd-cart__button").style.display="none";let a=new CustomEvent("MydOrderComplete",{bubbles:!0,cancelable:!0,composed:!1});window.dispatchEvent(a),"yes"==mydStoreInfo.autoRedirect&&(window.location.href=t.link)})):console.log("Network response was not ok.")})).catch((function(e){console.log("Problem with your fetch request: "+e.message)}))}function clearOrder(){sessionStorage.setItem("mydOrder","")}function getOrder(){let e=sessionStorage.getItem("mydOrder");return""!=e&&JSON.parse(e)}function checkOrderProductsEmpty(){return 0!=getOrder().products.length}